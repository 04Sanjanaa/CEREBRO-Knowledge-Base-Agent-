<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CEREBRO</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      color: #2c3e50;
      min-height: 100vh;
    }
    
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 20px 24px;
      border-bottom: none;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    .header-title {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .header-title h1 {
      font-size: 28px;
      font-weight: 700;
      color: white;
    }
    .header-title .subtitle {
      color: rgba(255, 255, 255, 0.85);
      font-size: 13px;
    }
    .status-badge {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }
    
    .tabs-container {
      background: white;
      border-bottom: 2px solid #f0f0f0;
      padding: 0 24px;
      display: flex;
      gap: 0;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    .tab-btn {
      border: none;
      background: none;
      padding: 14px 18px;
      cursor: pointer;
      color: #8e99b3;
      font-size: 14px;
      font-weight: 500;
      border-bottom: 3px solid transparent;
      transition: all 0.3s;
    }
    .tab-btn.active {
      color: #667eea;
      border-bottom-color: #667eea;
    }
    .tab-btn:hover {
      color: #667eea;
    }
    
    .main-container {
      padding: 24px;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .chat-section {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .chat-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 28px;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(102, 126, 234, 0.2);
    }
    .chat-header h2 {
      font-size: 32px;
      margin-bottom: 8px;
      font-weight: 700;
    }
    .chat-header p {
      font-size: 15px;
      opacity: 0.9;
    }
    
    .messages-container {
      background: white;
      border-radius: 16px;
      padding: 20px;
      height: 500px;
      overflow-y: auto;
      border: 1px solid #e8e8e8;
      margin-bottom: 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }
    
    .message {
      margin-bottom: 16px;
      display: flex;
      animation: slideIn 0.3s ease;
    }
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .msg-user {
      justify-content: flex-end;
    }
    .msg-bubble {
      max-width: 70%;
      padding: 12px 16px;
      border-radius: 12px;
      word-wrap: break-word;
      white-space: pre-wrap;
      line-height: 1.6;
    }
    .msg-user .msg-bubble {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-bottom-right-radius: 4px;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
    }
    .msg-assistant .msg-bubble {
      background: #f5f7fa;
      color: #2c3e50;
      border-bottom-left-radius: 4px;
      border-left: 3px solid #667eea;
    }
    
    .msg-time {
      font-size: 11px;
      color: #999;
      margin-top: 6px;
      padding: 0 12px;
    }
    
    .input-area {
      background: white;
      padding: 20px;
      border-radius: 16px;
      border: 1px solid #e8e8e8;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }
    
    .input-field {
      width: 100%;
      padding: 12px;
      border: 2px solid #e8e8e8;
      border-radius: 10px;
      font-family: inherit;
      font-size: 14px;
      resize: vertical;
      min-height: 80px;
      margin-bottom: 12px;
      transition: all 0.3s;
    }
    .input-field:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .button-group {
      display: flex;
      gap: 8px;
    }
    
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
    }
    
    .examples-section {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
      border: 1px solid rgba(102, 126, 234, 0.2);
      border-radius: 16px;
      padding: 20px;
      margin-top: 24px;
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
    }
    
    .examples-title {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 15px;
      font-weight: 700;
      color: #667eea;
      margin-bottom: 12px;
    }
    
    .example-btn {
      background: white;
      border: 1px solid #ddd;
      padding: 12px 16px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 13px;
      color: #2c3e50;
      text-align: left;
      transition: all 0.3s;
      margin-bottom: 8px;
      width: 100%;
    }
    .example-btn:hover {
      border-color: #667eea;
      background: #f8f9ff;
      transform: translateX(4px);
    }
    
    .how-it-works {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.08) 0%, rgba(118, 75, 162, 0.08) 100%);
      border: 1px solid rgba(102, 126, 234, 0.2);
      border-radius: 16px;
      padding: 20px;
      margin-top: 24px;
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
    }
    
    .how-it-works-title {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 16px;
      font-weight: 700;
      color: #667eea;
      margin-bottom: 12px;
    }
    
    .how-it-works ol {
      margin: 0;
      padding-left: 20px;
    }
    .how-it-works li {
      font-size: 13px;
      color: #555;
      margin-bottom: 8px;
      line-height: 1.4;
    }
    
    .hidden { display: none; }
    
    .docs-list, .logs-list, .stats-list {
      background: white;
      border-radius: 16px;
      padding: 20px;
      border: 1px solid #e8e8e8;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }
    
    .card {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
      padding: 16px;
      border-radius: 10px;
      margin-bottom: 12px;
      border-left: 3px solid #667eea;
    }
    .card h3 { 
      margin-top: 0; 
      color: #667eea;
      font-weight: 700;
    }
    .card p { 
      color: #666; 
      font-size: 13px;
    }
    .card pre { 
      background: white; 
      padding: 12px; 
      border-radius: 6px;
      overflow-x: auto;
      font-size: 12px;
      color: #333;
      border: 1px solid #e8e8e8;
    }
    
    .search-filters {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }
    
    .filter-btn {
      padding: 8px 14px;
      border: 1px solid #ddd;
      background: white;
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
      color: #666;
      transition: all 0.3s;
    }
    
    .filter-btn.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-color: #667eea;
    }
    
    .filter-btn:hover {
      border-color: #667eea;
    }
    
    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      margin-bottom: 16px;
    }
    
    .info-card {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.08) 0%, rgba(118, 75, 162, 0.08) 100%);
      padding: 14px;
      border-radius: 10px;
      border: 1px solid rgba(102, 126, 234, 0.2);
    }
    
    .info-label {
      font-size: 11px;
      color: #999;
      font-weight: 600;
      text-transform: uppercase;
      margin-bottom: 4px;
    }
    
    .info-value {
      font-size: 16px;
      color: #667eea;
      font-weight: 700;
    }
    
    .feedback-section {
      margin-top: 8px;
      padding-top: 8px;
      border-top: 1px solid rgba(0,0,0,0.1);
      display: flex;
      gap: 8px;
      align-items: center;
    }
    
    .feedback-btn {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 14px;
      padding: 4px 8px;
      color: #999;
      transition: all 0.2s;
    }
    
    .feedback-btn:hover {
      color: #667eea;
      transform: scale(1.2);
    }
    
    .advanced-options {
      background: white;
      padding: 16px;
      border-radius: 10px;
      margin-top: 12px;
      border: 1px solid #e8e8e8;
      display: none;
    }
    
    .advanced-options.show {
      display: block;
    }
    
    .option-group {
      margin-bottom: 12px;
    }
    
    .option-label {
      font-size: 12px;
      font-weight: 600;
      color: #667eea;
      margin-bottom: 6px;
      display: block;
    }
    
    .option-select {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 13px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="header-title">
      <div style="width: 40px; height: 40px; background: rgba(255,255,255,0.2); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 22px;">üß†</div>
      <div>
        <h1>CEREBRO</h1>
        <span class="subtitle">AI Knowledge Base Assistant</span>
      </div>
    </div>
    <div class="status-badge">‚óè Active</div>
  </div>
  
  <div class="tabs-container">
    <button class="tab-btn active" id="tab-chat">üí¨ Chat</button>
    <button class="tab-btn" id="tab-docs">üìÑ Documents</button>
    <button class="tab-btn" id="tab-logs">üìä Query Logs</button>
    <button class="tab-btn" id="tab-stats">‚öôÔ∏è System Info</button>
  </div>
  
  <div class="main-container">
    <section id="view-chat" class="chat-section">
      <div class="chat-header">
        <h2>Ask CEREBRO</h2>
        <p>Get instant answers from company knowledge base</p>
      </div>
      
      <div class="messages-container" id="messages">
        <div style="text-align: center; color: #999; padding: 40px 20px;">
          <div style="font-size: 56px; margin-bottom: 16px;">üß†</div>
          <div style="font-size: 26px; font-weight: 600; color: #667eea; margin-bottom: 8px;">Hello, I'm CEREBRO</div>
          <div style="font-size: 15px; color: #999; margin-bottom: 4px;">Your AI-powered knowledge base assistant</div>
          <div style="font-size: 13px; color: #bbb;">Ask me anything about company policies and procedures</div>
        </div>
      </div>
      
      <div class="input-area">
        <form id="chat-form">
          <textarea id="query" class="input-field" placeholder="Ask about policies, procedures, or guidelines..."></textarea>
          <div class="button-group">
            <button type="submit" class="btn btn-primary">üîç Ask</button>
          </div>
        </form>
      </div>
      
      
      <div class="examples-section">
        <div class="examples-title">Example Questions</div>
        <button class="example-btn" onclick="selectExample('What is the annual leave policy?')">What is the annual leave policy?</button>
        <button class="example-btn" onclick="selectExample('How do I submit expense reimbursements?')">How do I submit expense reimbursements?</button>
        <button class="example-btn" onclick="selectExample('What are the steps for new employee onboarding?')">What are the steps for new employee onboarding?</button>
        <button class="example-btn" onclick="selectExample('What is the remote work policy?')">What is the remote work policy?</button>
        <button class="example-btn" onclick="selectExample('How do I contact IT support?')">How do I contact IT support?</button>
      </div>
      
      <div class="how-it-works">
        <div class="how-it-works-title">How It Works</div>
        <ol>
          <li><strong>You ask a question</strong></li>
          <li><strong>CEREBRO searches company documents</strong></li>
          <li><strong>Relevant information is retrieved</strong></li>
          <li><strong>Clear answer with sources provided</strong></li>
        </ol>
      </div>
    </section>
    
    <section id="view-docs" class="hidden docs-list">
    </section>
    
    <section id="view-logs" class="hidden logs-list">
    </section>
    
    <section id="view-stats" class="hidden stats-list">
    </section>

  </div>
  
  <script>
    const tabs = ['chat','docs','logs','stats'];
    const STORAGE_KEY = 'kb_agent_chat_history';

    // Load chat history from localStorage
    function loadChatHistory(){
      const saved = localStorage.getItem(STORAGE_KEY);
      if(saved){
        try{
          const history = JSON.parse(saved);
          history.forEach(msg => addMessageDOM(msg.role, msg.content, msg.sources, false));
          scrollToBottom();
        }catch(e){console.error('Failed to load chat history:', e)}
      }
    }

    // Save message to localStorage
    function saveChatMessage(role, content, sources){
      const saved = localStorage.getItem(STORAGE_KEY);
      let history = [];
      if(saved){
        try{
          history = JSON.parse(saved);
        }catch(e){console.error('Failed to parse history:', e)}
      }
      history.push({role, content, sources, timestamp: new Date().toISOString()});
      localStorage.setItem(STORAGE_KEY, JSON.stringify(history));
    }

    function setActive(tab){
      tabs.forEach(t=>{
        document.getElementById('tab-'+t).classList.remove('active');
        document.getElementById('view-'+t).classList.add('hidden');
      });
      document.getElementById('tab-'+tab).classList.add('active');
      document.getElementById('view-'+tab).classList.remove('hidden');
      if(tab==='docs') loadDocuments();
      if(tab==='logs') loadLogs();
      if(tab==='stats') loadStats();
    }

    document.getElementById('tab-chat').onclick = e=>{e.preventDefault(); setActive('chat')}
    document.getElementById('tab-docs').onclick = e=>{e.preventDefault(); setActive('docs')}
    document.getElementById('tab-logs').onclick = e=>{e.preventDefault(); setActive('logs')}
    document.getElementById('tab-stats').onclick = e=>{e.preventDefault(); setActive('stats')}

    async function api(path, opts){
      const res = await fetch(path, opts);
      if(!res.ok) {
        const text = await res.text();
        console.error('API Error Status:', res.status, 'Response:', text);
        throw new Error('API error: '+res.status);
      }
      return res.json();
    }

    function scrollToBottom(){
      setTimeout(() => {
        const messagesEl = document.getElementById('messages');
        messagesEl.scrollTop = messagesEl.scrollHeight;
      }, 50);
    }

    function addMessageDOM(role, content, sources, save=true){
      const m = document.createElement('div');
      m.className = 'message ' + (role==='user'?'msg-user':'msg-assistant');
      const now = new Date().toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit'});
      
      // Clear welcome message on first interaction
      const messagesEl = document.getElementById('messages');
      const hasWelcome = messagesEl.innerHTML.includes('CEREBRO');
      if(hasWelcome){
        messagesEl.innerHTML = '';
      }
      
      // Format content with proper line breaks and styling
      let formattedContent = content
        // Handle bold markdown (**text**)
        .replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>')
        // Handle related documents in brackets [...]
        .replace(/\[Related documents: ([^\]]+)\]/g, '<div style="text-align: right; font-size: 11px; color: #999; margin-top: 12px;">Related: $1</div>')
        // Handle line breaks
        .replace(/\n/g, '<br>');
      
      let html = '<div class="msg-bubble">'+formattedContent;
      
      // Add feedback buttons only for assistant messages
      if(role === 'assistant'){
        html += '<div class="feedback-section">';
        html += '<span style="font-size: 12px; color: #999;">Was this helpful?</span>';
        html += '<button class="feedback-btn" onclick="giveFeedback(\'helpful\')">üëç</button>';
        html += '<button class="feedback-btn" onclick="giveFeedback(\'nothelp\')">üëé</button>';
        html += '</div>';
      }
      
      html += '</div>';
      html += '<div class="msg-time">'+now+'</div>';
      
      m.innerHTML = html;
      document.getElementById('messages').appendChild(m);
      if(save) saveChatMessage(role, content, sources);
      scrollToBottom();
      updateStats();
    }
    
    
    function giveFeedback(type){
      alert(type === 'helpful' ? 'Thanks for the feedback! üòä' : 'We\'ll improve this answer.');
    }
    
    // Voice Input Handler
    let recognition = null;
    let isListening = false;
    
    function initVoiceInput(){
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if(!SpeechRecognition){
        alert('Voice input is not supported in your browser. Please use Chrome, Edge, or Safari.');
        return;
      }
      recognition = new SpeechRecognition();
      recognition.continuous = false;
      recognition.interimResults = true;
      recognition.lang = 'en-US';
      
      recognition.onstart = () => {
        isListening = true;
        document.getElementById('voice-btn').textContent = 'üéôÔ∏è Listening...';
        document.getElementById('voice-btn').style.background = '#667eea';
        document.getElementById('voice-btn').style.color = 'white';
      };
      
      recognition.onresult = (event) => {
        let transcript = '';
        for(let i = event.resultIndex; i < event.results.length; i++){
          transcript += event.results[i][0].transcript;
        }
        
        if(event.isFinal){
          document.getElementById('query').value = transcript;
          stopVoiceInput();
          // Auto-submit the query after voice input
          setTimeout(() => document.getElementById('chat-form').dispatchEvent(new Event('submit', {cancelable:true})), 500);
        } else {
          document.getElementById('query').placeholder = 'Heard: ' + transcript;
        }
      };
      
      recognition.onerror = (event) => {
        console.error('Voice error:', event.error);
        // Show a user-facing banner with guidance and fallback actions
        try{ showVoiceErrorBanner(event.error || 'unknown'); }catch(e){}
        // For common 'not-allowed' reason, give specific console guidance
        if(event.error === 'not-allowed'){
          console.log('Microphone access denied. The Web Speech API requires HTTPS or localhost. Try opening the app at http://localhost:5000');
        }
        stopVoiceInput();
      };
      
      recognition.onend = () => {
        stopVoiceInput();
      };
    }
    
    function toggleVoiceInput(){
      if(!recognition) initVoiceInput();
      
      if(isListening){
        recognition.stop();
      } else {
        document.getElementById('query').placeholder = 'Listening...';
        try {
          recognition.start();
        } catch(e){
          console.error('Voice start error:', e);
          document.getElementById('query').placeholder = 'Please use http://localhost:5000 for voice input';
        }
      }
    }
    
    function stopVoiceInput(){
      isListening = false;
      document.getElementById('voice-btn').textContent = 'üé§ Voice';
      document.getElementById('voice-btn').style.background = 'white';
      document.getElementById('voice-btn').style.color = '#667eea';
      document.getElementById('query').placeholder = 'Ask about policies, procedures, or guidelines...';
      hideVoiceErrorBanner();
    }

    function showVoiceErrorBanner(error){
      const el = document.getElementById('voice-error-banner');
      const msg = document.getElementById('voice-error-message');
      if(msg) msg.innerText = 'Voice input blocked: '+error+". Try opening the app at http://localhost:5000 or type your question below.";
      if(el) el.classList.remove('hidden');
    }

    function hideVoiceErrorBanner(){
      const el = document.getElementById('voice-error-banner');
      if(el) el.classList.add('hidden');
    }

    function openLocalhost(){
      try{ window.location.href = 'http://localhost:5000'; }catch(e){ console.error(e); }
    }

    function copyLocalhost(){
      if(navigator.clipboard) navigator.clipboard.writeText('http://localhost:5000').then(()=>alert('Copied localhost link to clipboard'));
    }

    function focusQuery(){
      document.getElementById('query').focus();
      hideVoiceErrorBanner();
    }

    function updateStats(){
      const saved = localStorage.getItem(STORAGE_KEY);
      const count = saved ? JSON.parse(saved).length : 0;
      const statsEl = document.getElementById('query-count');
      if(statsEl) statsEl.innerText = Math.floor(count / 2);
    }

    function addMessage(role, content, sources){
      addMessageDOM(role, content, sources, true);
    }

    document.getElementById('chat-form').onsubmit = async function(e){
      e.preventDefault();
      const q = document.getElementById('query').value.trim();
      if(!q) return;
      addMessage('user', q);
      document.getElementById('query').value='';

      // Show a temporary loading message from assistant
      addMessage('assistant', '‚è≥ Thinking...');

      try{
        const r = await api('/api/query', {method:'POST',headers:{'Content-Type':'application/json'}, body:JSON.stringify({query:q})});
        console.log('API Response:', r);
        // Remove the temporary 'Thinking...' bubble (last assistant message)
        try{
          const msgs = document.getElementById('messages');
          const children = msgs.querySelectorAll('.message');
          for(let i = children.length-1; i>=0; i--){
            const el = children[i];
            if(el.classList.contains('msg-assistant')){
              const bubble = el.querySelector('.msg-bubble');
              if(bubble && bubble.innerText.includes('Thinking')){ msgs.removeChild(el); break; }
            }
          }
        }catch(e){console.error('Failed to remove loading message', e)}

        if(r && r.response){
          addMessage('assistant', r.response, r.sources);
          loadLogs();
        } else if(r && r.error){
          addMessage('assistant', '‚ùå Server error: '+(r.error||'unknown'));
        } else {
          addMessage('assistant', '‚ùå No response received from server');
        }
      }catch(err){
        console.error('Query Error:', err);
        // Remove loading bubble
        try{
          const msgs = document.getElementById('messages');
          const children = msgs.querySelectorAll('.message');
          for(let i = children.length-1; i>=0; i--){
            const el = children[i];
            if(el.classList.contains('msg-assistant')){
              const bubble = el.querySelector('.msg-bubble');
              if(bubble && bubble.innerText.includes('Thinking')){ msgs.removeChild(el); break; }
            }
          }
        }catch(e){}
        addMessage('assistant', '‚ùå Error: '+err.message);
      }
    }

    function selectExample(q){
      document.getElementById('query').value = q;
      document.getElementById('query').focus();
    }

    async function loadDocuments(){
      try{
        const r = await api('/api/documents');
        const el = document.getElementById('view-docs');
        el.innerHTML = '';
        r.documents.forEach(d=>{
          const card = document.createElement('div'); 
          card.className='card';
          card.innerHTML = '<h3>'+d.title+'</h3><p>'+d.section+'</p><pre>'+d.content+'</pre>';
          el.appendChild(card);
        });
      }catch(err){document.getElementById('view-docs').innerText='Failed to load documents'}
    }

    async function loadLogs(){
      try{
        const r = await api('/api/logs');
        const el = document.getElementById('view-logs'); 
        el.innerHTML='';
        if(r.logs.length === 0){
          el.innerHTML = '<p style="color: #999;">No queries yet</p>';
          return;
        }
        r.logs.slice().reverse().forEach(l=>{
          const card = document.createElement('div'); 
          card.className='card';
          card.innerHTML = '<p><strong>'+l.query+'</strong></p><p style="color: #999; font-size: 12px;">'+l.timestamp+'</p>'+(l.sources && l.sources.length ? '<p>Sources: '+l.sources.map(s=>s.title).join(', ')+'</p>' : '');
          el.appendChild(card);
        });
      }catch(err){document.getElementById('view-logs').innerText='Failed to load logs'}
    }

    async function loadStats(){
      try{
        const r = await api('/api/stats');
        const el = document.getElementById('view-stats'); 
        el.innerHTML='';
        for(const k in r.stats){
          const card = document.createElement('div'); 
          card.className='card'; 
          card.innerHTML = '<h3>'+k+'</h3><p>'+r.stats[k]+'</p>'; 
          el.appendChild(card);
        }
      }catch(err){document.getElementById('view-stats').innerText='Failed to load stats'}
    }

    async function checkBackend(){
      try{
        const r = await api('/api/health');
        console.log('Backend status:', r.status);
      }catch(err){
        console.error('Backend down');
      }
    }

    // Load on start
    checkBackend();
    // Don't load chat history on page load - start fresh
    // loadChatHistory();
    updateStats();
  </script>
</body>
</html>
